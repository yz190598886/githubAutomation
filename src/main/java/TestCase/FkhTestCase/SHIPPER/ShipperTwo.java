package TestCase.FkhTestCase.SHIPPER;import Method.HttpRequest;import Method.StringTools;import Method.jdbc;import org.apache.log4j.Logger;import org.testng.Assert;/** * Created by yz on 2018/7/5. */public class ShipperTwo {    private static final Logger log =Logger.getLogger(ShipperOne.class);    public void FKHOwnerProcessTwo() throws Exception {        /*         *APP:千迅智运         *项目：自己作为承运方         *计划：件+不扣磅差+以发货为准         *派车         *上传、完善、审核发货凭证+确认卸货         * */        log.info("\n/**\n*APP:千迅智运\n*项目：自己作为承运方\n*计划：件+不扣磅差+以发货为准\n*派车\n*上传、完善、审核发货凭证+确认卸货\n**/");        //数据库、请求、工具        jdbc db=new jdbc();        StringTools stringTools=new StringTools();        HttpRequest httpRequest=new HttpRequest();        String ProjectId=ShipperOne.ProjectId;        String userId=ShipperOne.userId;        log.info("-----------------创建计划-----------------");        String addProgram="https://dev.fkhwl.com/fkhtest/api/obd/project/addProgram/"+userId;        log.info(addProgram);        String name=stringTools.name();        String PlanName="以发货件"+name;        String addProgramJson="{\"projectId\":"+ProjectId+",\"planName\":\""+PlanName+"\",\"loadAddress\":1299,\"arrivalAddress\":1293,\"departureCity\":\"重庆\",\"arrivalCity\":\"四川-成都\",\"units\":\"件\",\"cargoPrice\":10.0,\"packagedForm\":1101,\"modelType\":\"152\",\"programNo\":100.0,\"arrivalAddressWarn\":1,\"loadAddressWarn\":1,\"carLength\":\"不限\",\"carType\":\"不限\",\"unitPrice\":0.0,\"cargoDesc\":\"\",\"poundKey\":3,\"poundValue\":\"-1\",\"programStartDate\":0,\"programEndDate\":0,\"mileage\":\"298公里\"}";        log.info("参数："+addProgramJson);        String addProgramBack=httpRequest.postDataWithJson(addProgram,addProgramJson);        log.info(addProgramBack);        String HttpAddProgramBack=stringTools.back(addProgramBack);        Assert.assertEquals(stringTools.code(addProgramBack),"200","创建计划失败！");        Assert.assertEquals(httpRequest.Jsonvalue(HttpAddProgramBack,"rescode"),"1200","创建计划失败！");        Assert.assertEquals(httpRequest.Jsonvalue(HttpAddProgramBack,"message"),"操作成功","创建计划失败！");        String SqlPlanId="select id from program where programName='"+PlanName+"'";        String PlanId=db.getSearchResult(SqlPlanId);        log.info("创建计划成功："+PlanName+",Id:"+PlanId);        log.info("-----------------派车-----------------");        String sendOrAssign="https://dev.fkhwl.com/fkhtest/api/cargos/sendOrAssign/"+userId;        log.info(sendOrAssign);        String sendOrAssignJson="{\"planId\":"+PlanId+",\"cargoNum\":\"10.0件\",\"vehicleIds\":\"8072\",\"sijiIds\":\"8073\",\"logisticId\":0}";        log.info("参数："+sendOrAssignJson);        String sendOrAssignBack=httpRequest.postDataWithJson(sendOrAssign,sendOrAssignJson);        String HttpBackSendOrAssign=stringTools.back(sendOrAssignBack);        log.info(HttpBackSendOrAssign);        Assert.assertEquals(stringTools.code(sendOrAssignBack),"200","派车失败！");        Assert.assertEquals(httpRequest.Jsonvalue(HttpBackSendOrAssign,"rescode"),"1200","派车失败！");        Assert.assertEquals(httpRequest.Jsonvalue(HttpBackSendOrAssign,"message"),"操作成功","派车失败！");        String SqlWaybillId="select waybillId from waybillcar where driverId=8073 and waybillCarStatus=1";        String SqlWaybillNo="select waybillNo from waybillcar where driverId=8073 and waybillCarStatus=1";        String SqlwaybillCarId="select id from waybillcar where driverId=8073 and waybillCarStatus=1";        String WaybillId=db.getSearchResult(SqlWaybillId);//数据库获取运单id        String WaybillNo=db.getSearchResult(SqlWaybillNo);//数据库获取运单号        String waybillCarId=db.getSearchResult(SqlwaybillCarId);//数据库获取运单车辆表id        log.info("派车成功，运单号："+WaybillNo+",Id:"+WaybillId+",waybillCarId:"+waybillCarId);        log.info("--------------------上传装货凭证--------------------");        String senderuploadinvoice="https://dev.fkhwl.com/fkhtest/api/waybills/sender/uploadinvoice/"+userId+"/"+WaybillId;        log.info(senderuploadinvoice);        String senderuploadinvoiceJson="{\"invoice\":\"https://dev.fkhwl.com/uploads/thumbnail/thumbnail_1530778284694_1_.jpg\"}";        log.info("参数："+senderuploadinvoiceJson);        String senderuploadinvoiceBack=httpRequest.postDataWithJson(senderuploadinvoice,senderuploadinvoiceJson);        log.info(senderuploadinvoiceBack);        String HttpBacksenderuploadinvoice=stringTools.back(senderuploadinvoiceBack);        Assert.assertEquals(stringTools.code(senderuploadinvoiceBack),"200","上传装货凭证失败！");        Assert.assertEquals(httpRequest.Jsonvalue(HttpBacksenderuploadinvoice,"rescode"),"1200","上传装货凭证失败！");        Assert.assertEquals(httpRequest.Jsonvalue(HttpBacksenderuploadinvoice,"message"),"操作成功","上传装货凭证失败！");        log.info("上传收货凭证成功！");        log.info("--------------------确认卸货--------------------");        String confirmShipperBill="https://dev.fkhwl.com/fkhtest/api/waybills/confirmShipperBill/2";        log.info(confirmShipperBill);        String confirmShipperBillJson="{\"userId\":"+userId+",\"waybillCarId\":"+WaybillId+"}";        log.info("参数："+confirmShipperBillJson);        String confirmShipperBillJBack=httpRequest.postDataWithJson(confirmShipperBill,confirmShipperBillJson);        log.info(confirmShipperBillJBack);        String HttpBackconfirmShipperBill=stringTools.back(confirmShipperBillJBack);        Assert.assertEquals(stringTools.code(confirmShipperBillJBack),"200","确认卸货失败！");        Assert.assertEquals(httpRequest.Jsonvalue(HttpBackconfirmShipperBill,"rescode"),"1200","确认卸货失败！");        Assert.assertEquals(httpRequest.Jsonvalue(HttpBackconfirmShipperBill,"message"),"操作成功","确认卸货失败！");        log.info("确认卸货成功！");        log.info("--------------------完善发货凭证--------------------");        String senderwriteDetail="https://dev.fkhwl.com/fkhtest/api/waybills/sender/writeDetail/"+userId+"/"+waybillCarId;        log.info(senderwriteDetail);        String senderwriteDetailJson="{\"receiveGrossWeight\":0.0,\"receiveNetWeight\":0.0,\"receiveTareWeight\":0.0,\"sendGrossWeight\":0.0,\"sendNetWeight\":100.0,\"sendTareWeight\":0.0,\"allowDifference\":2,\"allowDifferenceVal\":0.0,\"allowDifferenceAmount\":10.0,\"totalPrice\":1000.0,\"unitPrice\":10.0,\"valuePrice\":10.0,\"invoice\":\"https://dev.fkhwl.com/uploads/thumbnail/thumbnail_1530783706255_1_.jpg,https://dev.fkhwl.com/uploads/thumbnail/thumbnail_1530784244244_1_.jpg\",\"unit\":2}";        log.info("参数"+senderwriteDetailJson);        String senderwriteDetailBack=httpRequest.postDataWithJson(senderwriteDetail,senderwriteDetailJson);        log.info(senderwriteDetailBack);        String HttpBacksenderwriteDetail=stringTools.back(senderwriteDetailBack);        Assert.assertEquals(stringTools.code(senderwriteDetailBack),"200","上传收货凭证失败！");        Assert.assertEquals(httpRequest.Jsonvalue(HttpBacksenderwriteDetail,"rescode"),"1200","完善发货凭证失败！");        Assert.assertEquals(httpRequest.Jsonvalue(HttpBacksenderwriteDetail,"message"),"操作成功","完善发货凭证失败！");        log.info("完善发货凭证成功！");        log.info("--------------------复核发货凭（通过）--------------------");        String FHcheck="https://dev.fkhwl.com/fkhtest/api/shipper/bills/check/"+userId;        log.info(FHcheck);        String FHcheckJson="{\"waybillCarId\":"+waybillCarId+",\"agree\":1,\"billType\":1,\"cashPayAmount\":\"1000.0\"}";        log.info("参数："+FHcheckJson);        String FHcheckBack=httpRequest.postDataWithJson(FHcheck,FHcheckJson);        log.info(FHcheckBack);        String HttpBackFHcheck=stringTools.back(FHcheckBack);        Assert.assertEquals(stringTools.code(FHcheckBack),"200","复核发货凭证失败！");        Assert.assertEquals(httpRequest.Jsonvalue(HttpBackFHcheck,"rescode"),"1200","复核发货凭证失败！");        Assert.assertEquals(httpRequest.Jsonvalue(HttpBackFHcheck,"message"),"操作成功","复核发货凭证失败！");        log.info("复核发货凭成功！（通过）");    }}