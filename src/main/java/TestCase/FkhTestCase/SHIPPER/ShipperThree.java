package TestCase.FkhTestCase.SHIPPER;import Method.HttpRequest;import Method.StringTools;import Method.jdbc;import org.apache.log4j.Logger;import org.testng.Assert;/** * Created by yz on 2018/7/9. */public class ShipperThree {    private static final Logger log =Logger.getLogger(ShipperOne.class);    public void FKHOwnerProcessThree() throws Exception {        /*         *APP:千迅智运         *项目：自己作为承运方         *计划：吨+不扣磅差+以收货为准         *派车         *上传、完善、审核收货凭证+确认装货         * */        log.info("\n/**\n*APP:千迅智运\n*项目：自己作为承运方\n*计划：吨+不扣磅差+以收货为准\n*派车\n*上传、完善、审核收货凭证+确认装货\n**/");        //数据库、请求、工具        jdbc db=new jdbc();        StringTools stringTools=new StringTools();        HttpRequest httpRequest=new HttpRequest();        String ProjectId=ShipperOne.ProjectId;        String userId=ShipperOne.userId;        log.info("-----------------创建计划-----------------");        String addProgram="https://dev.fkhwl.com/fkhtest/api/obd/project/addProgram/"+userId;        log.info(addProgram);        String name=stringTools.name();        String PlanName="以收货吨"+name;        String addProgramJson="{\"projectId\":"+ProjectId+",\"planName\":\""+PlanName+"\",\"loadAddress\":1299,\"arrivalAddress\":1293,\"departureCity\":\"重庆\",\"arrivalCity\":\"四川-成都\",\"units\":\"吨\",\"cargoPrice\":10.0,\"packagedForm\":1102,\"modelType\":\"31616 200-399\",\"programNo\":100.0,\"arrivalAddressWarn\":1,\"loadAddressWarn\":1,\"carLength\":\"不限\",\"carType\":\"不限\",\"unitPrice\":0.0,\"cargoDesc\":\"\",\"poundKey\":3,\"poundValue\":\"-2\",\"programStartDate\":0,\"programEndDate\":0,\"mileage\":\"298公里\"}";        log.info("参数："+addProgramJson);        String addProgramBack=httpRequest.postDataWithJson(addProgram,addProgramJson);        log.info(addProgramBack);        String HttpAddProgramBack=stringTools.back(addProgramBack);        Assert.assertEquals(stringTools.code(addProgramBack),"200","创建计划失败！");        Assert.assertEquals(httpRequest.Jsonvalue(HttpAddProgramBack,"rescode"),"1200","创建计划失败！");        Assert.assertEquals(httpRequest.Jsonvalue(HttpAddProgramBack,"message"),"操作成功","创建计划失败！");        String SqlPlanId="select id from program where programName='"+PlanName+"'";        String PlanId=db.getSearchResult(SqlPlanId);        log.info("创建计划成功："+PlanName+",Id:"+PlanId);        log.info("-----------------派车-----------------");        String sendOrAssign="https://dev.fkhwl.com/fkhtest/api/cargos/sendOrAssign/"+userId;        log.info(sendOrAssign);        String sendOrAssignJson="{\"planId\":"+PlanId+",\"cargoNum\":\"10.0吨\",\"vehicleIds\":\"8072\",\"sijiIds\":\"8073\",\"logisticId\":0}";        log.info("参数："+sendOrAssignJson);        String sendOrAssignBack=httpRequest.postDataWithJson(sendOrAssign,sendOrAssignJson);        String HttpBackSendOrAssign=stringTools.back(sendOrAssignBack);        log.info(HttpBackSendOrAssign);        Assert.assertEquals(stringTools.code(sendOrAssignBack),"200","派车失败！");        Assert.assertEquals(httpRequest.Jsonvalue(HttpBackSendOrAssign,"rescode"),"1200","派车失败！");        Assert.assertEquals(httpRequest.Jsonvalue(HttpBackSendOrAssign,"message"),"操作成功","派车失败！");        String SqlWaybillId="select waybillId from waybillcar where driverId=8073 and waybillCarStatus=1";        String SqlWaybillNo="select waybillNo from waybillcar where driverId=8073 and waybillCarStatus=1";        String SqlwaybillCarId="select id from waybillcar where driverId=8073 and waybillCarStatus=1";        String WaybillId=db.getSearchResult(SqlWaybillId);//数据库获取运单id        String WaybillNo=db.getSearchResult(SqlWaybillNo);//数据库获取运单号        String waybillCarId=db.getSearchResult(SqlwaybillCarId);//数据库获取运单车辆表id        log.info("派车成功，运单号："+WaybillNo+",Id:"+WaybillId+",waybillCarId:"+waybillCarId);        log.info("--------------------确认装货--------------------");        String confirmShipperBill="https://dev.fkhwl.com/fkhtest/api/waybills/confirmShipperBill/1";        log.info(confirmShipperBill);        String confirmShipperBillJson="{\"userId\":"+userId+",\"waybillCarId\":"+WaybillId+"}";        log.info("参数："+confirmShipperBillJson);        String confirmShipperBillBack=httpRequest.postDataWithJson(confirmShipperBill,confirmShipperBillJson);        log.info(confirmShipperBillBack);        String HttpBackconfirmShipperBill=stringTools.back(confirmShipperBillBack);        Assert.assertEquals(stringTools.code(confirmShipperBillBack),"200","确认装货失败！");        Assert.assertEquals(httpRequest.Jsonvalue(HttpBackconfirmShipperBill,"rescode"),"1200","确认装货失败！");        Assert.assertEquals(httpRequest.Jsonvalue(HttpBackconfirmShipperBill,"message"),"操作成功","确认装货失败！");        log.info("确认装货成功！");        log.info("--------------------上传收货凭证--------------------");        String consigneeuploadinvoice="https://dev.fkhwl.com/fkhtest/api/waybills/consignee/uploadinvoice/"+userId+"/"+WaybillId;        log.info(consigneeuploadinvoice);        String consigneeuploadinvoiceJson="{\"invoice\":\"https://dev.fkhwl.com/uploads/thumbnail/thumbnail_1530778284694_1_.jpg\"}";        log.info("参数："+consigneeuploadinvoiceJson);        String consigneeuploadinvoiceBack=httpRequest.postDataWithJson(consigneeuploadinvoice,consigneeuploadinvoiceJson);        log.info(consigneeuploadinvoiceBack);        String HttpBackconsigneeuploadinvoice=stringTools.back(consigneeuploadinvoiceBack);        Assert.assertEquals(stringTools.code(consigneeuploadinvoiceBack),"200","上传收货凭证失败！");        Assert.assertEquals(httpRequest.Jsonvalue(HttpBackconsigneeuploadinvoice,"rescode"),"1200","上传收货凭证失败！");        Assert.assertEquals(httpRequest.Jsonvalue(HttpBackconsigneeuploadinvoice,"message"),"操作成功","上传收货凭证失败！");        log.info("上传收货凭证成功！");        log.info("--------------------完善收货凭证--------------------");        String consigneewriteDetail="https://dev.fkhwl.com/fkhtest/api/waybills/consignee/writeDetail/"+userId+"/"+waybillCarId;        log.info(consigneewriteDetail);        String consigneewriteDetailJson="{\"receiveGrossWeight\":100.0,\"receiveNetWeight\":90.0,\"receiveTareWeight\":10.0,\"sendGrossWeight\":100.0,\"sendNetWeight\":90.0,\"sendTareWeight\":10.0,\"allowDifference\":2,\"allowDifferenceVal\":0.0,\"allowDifferenceAmount\":0.0,\"totalPrice\":900.0,\"unitPrice\":10.0,\"valuePrice\":10.0,\"invoice\":\"https://dev.fkhwl.com/uploads/thumbnail/thumbnail_1531122364353_1_.jpg,https://dev.fkhwl.com/uploads/thumbnail/thumbnail_1531122577742_1_.jpg\",\"unit\":1}";        log.info("参数"+consigneewriteDetailJson);        String consigneewriteDetailBack=httpRequest.postDataWithJson(consigneewriteDetail,consigneewriteDetailJson);        log.info(consigneewriteDetailBack);        String HttpBackconsigneewriteDetail=stringTools.back(consigneewriteDetailBack);        Assert.assertEquals(stringTools.code(consigneewriteDetailBack),"200","完善收货凭证失败！");        Assert.assertEquals(httpRequest.Jsonvalue(HttpBackconsigneewriteDetail,"rescode"),"1200","完善收货凭证失败！");        Assert.assertEquals(httpRequest.Jsonvalue(HttpBackconsigneewriteDetail,"message"),"操作成功","完善收货凭证失败！");        log.info("完善收货凭证成功！");        log.info("--------------------复核收货凭证（通过）--------------------");        String SHcheck="https://dev.fkhwl.com/fkhtest/api/shipper/bills/check/"+userId;        log.info(SHcheck);        String SHcheckJson="{\"waybillCarId\":"+waybillCarId+",\"agree\":1,\"billType\":2,\"etcCardAmount\":\"0\",\"depositAmount\":\"0\",\"oilCardAmount\":\"0\",\"cashPayAmount\":\"900.0\"}";        log.info("参数："+SHcheckJson);        String SHcheckBack=httpRequest.postDataWithJson(SHcheck,SHcheckJson);        log.info(SHcheckBack);        String HttpBackSHcheck=stringTools.back(SHcheckBack);        Assert.assertEquals(stringTools.code(SHcheckBack),"200","复核收货凭失败！");        Assert.assertEquals(httpRequest.Jsonvalue(HttpBackSHcheck,"rescode"),"1200","复核收货凭失败！");        Assert.assertEquals(httpRequest.Jsonvalue(HttpBackSHcheck,"message"),"操作成功","复核收货凭失败！");        log.info("复核收货凭成功！（通过）");    }}